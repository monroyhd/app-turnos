# =============================================================================
# mosquitto.conf - Configuración de Mosquitto MQTT para App-Turnos
# =============================================================================
#
# Este archivo configura el broker MQTT Mosquitto para:
# - Conexiones TCP en puerto 1883
# - Conexiones WebSocket en puerto 9001 (para navegadores)
# - Modo anónimo habilitado (sin autenticación)
# - Persistencia de mensajes
#
# Ubicación: /etc/mosquitto/conf.d/app-turnos.conf
# =============================================================================

# =============================================================================
# Listeners
# =============================================================================

# Listener TCP estándar para clientes MQTT (solo localhost - más seguro)
listener 1883 127.0.0.1
protocol mqtt

# Listener WebSocket para navegadores (accesible via Caddy proxy /mqtt-ws)
# Nota: Mosquitto 2.0.x no soporta bind_address para websockets correctamente
# La seguridad se maneja via firewall (UFW bloquea puerto 9001 externamente)
listener 9001
protocol websockets

# =============================================================================
# Autenticación
# =============================================================================

# Permitir conexiones anónimas (sin usuario/contraseña)
# NOTA: Para producción con acceso externo, considerar habilitar autenticación
allow_anonymous true

# =============================================================================
# Persistencia
# =============================================================================

# Habilitar persistencia de mensajes retenidos y sesiones
persistence true
persistence_location /var/lib/mosquitto/

# Intervalo de guardado automático (en segundos)
autosave_interval 60

# =============================================================================
# Logging
# =============================================================================

# Destino de logs
log_dest stdout
log_dest file /var/log/mosquitto/mosquitto.log

# Tipos de mensajes a loguear
log_type error
log_type warning
log_type notice
log_type information

# Timestamp en logs
log_timestamp true

# =============================================================================
# Conexiones
# =============================================================================

# Máximo de conexiones simultáneas (0 = sin límite)
max_connections -1

# Timeout de keepalive
max_keepalive 60

# =============================================================================
# Mensajes
# =============================================================================

# Tamaño máximo de mensaje (en bytes)
message_size_limit 1048576

# Habilitar QoS 0, 1 y 2
max_qos 2

# Tiempo de retención de mensajes expirados (en segundos)
# 0 = mantener indefinidamente
persistent_client_expiration 0

# =============================================================================
# Sistema
# =============================================================================

# Usuario que ejecuta el servicio (comentar si se usa systemd)
# user mosquitto

# PID file
pid_file /var/run/mosquitto/mosquitto.pid
