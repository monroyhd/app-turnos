import{r as d,k as B,p as g,c as o,a as t,b as p,w as S,d as u,v as y,F as w,m as k,t as r,q as C,x as P,s as F,o as a,n as D,i as _}from"./index-B8ei-D0x.js";import{u as j,m as V}from"./mqttClient-Dn1Xfl5U.js";const z={class:"max-w-7xl mx-auto px-4 py-6"},G={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},H={class:"bg-white rounded-lg shadow p-6"},X={class:"flex space-x-2 mt-1"},J={key:0,class:"mt-2 border rounded-md max-h-40 overflow-y-auto"},K=["onClick"],Q={class:"font-medium"},Y={key:0,class:"text-gray-500 text-sm ml-2"},Z={key:1,class:"mt-2 p-2 bg-primary-50 rounded-md flex justify-between items-center"},ee=["value"],te=["value"],se=["disabled"],le={class:"bg-white rounded-lg shadow p-6"},oe={class:"space-y-3 max-h-96 overflow-y-auto"},ae={class:"flex justify-between items-start"},re={class:"text-lg font-bold text-primary-600"},ne={class:"text-sm text-gray-500"},ie={class:"mt-2 text-sm"},de={key:0},ue={key:1},pe={key:0,class:"mt-2 flex space-x-2"},me=["onClick"],ce=["onClick"],ve={key:0,class:"text-gray-500 text-center py-4"},be={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ye={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},xe={class:"flex items-center"},fe={class:"flex space-x-2"},Ce={__name:"CapturistaView",setup(ge){const m=j(),E=d([]),N=d([]),v=d(""),b=d([]),c=d(null),x=d(!1),f=d(!1),n=d({service_id:"",doctor_id:"",priority:0,notes:""}),i=d({full_name:"",curp:"",phone:"",is_preferential:!1});B(async()=>{await L(),V.connect(),V.onMessage("capturista",async l=>{l.event&&await m.fetchTurns({today:!0})})});async function L(){await m.fetchTurns({today:!0});const[l,e]=await Promise.all([g.get("/services?is_active=true"),g.get("/doctors?is_active=true")]);E.value=l.data.data,N.value=e.data.data}async function U(){if(v.value.length<2){b.value=[];return}const l=await g.get(`/patients?search=${v.value}`);b.value=l.data.data.slice(0,5)}function A(l){c.value=l,b.value=[],v.value=""}async function R(){var l,e;try{const s=await g.post("/patients",i.value);s.data.success&&(c.value=s.data.data,x.value=!1,i.value={full_name:"",curp:"",phone:"",is_preferential:!1})}catch(s){alert(((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.message)||"Error creando paciente")}}async function I(){var s;f.value=!0;const l={...n.value,patient_id:(s=c.value)==null?void 0:s.id},e=await m.createTurn(l);e.success?(n.value={service_id:"",doctor_id:"",priority:0,notes:""},c.value=null):alert(e.message),f.value=!1}async function M(l){await m.updateTurnStatus(l,"waiting")}async function $(l){confirm("Cancelar este turno?")&&await m.updateTurnStatus(l,"cancel")}function h(l){return{CREATED:"bg-gray-100 text-gray-800",WAITING:"bg-yellow-100 text-yellow-800",CALLED:"bg-blue-100 text-blue-800",IN_SERVICE:"bg-green-100 text-green-800",DONE:"bg-gray-200 text-gray-600",NO_SHOW:"bg-red-100 text-red-800",CANCELLED:"bg-red-200 text-red-900"}[l]||""}function O(l){return{CREATED:"Creado",WAITING:"En Espera",CALLED:"Llamado",IN_SERVICE:"En Atencion",DONE:"Finalizado",NO_SHOW:"No se presento",CANCELLED:"Cancelado"}[l]||l}function W(l){return l===2?"border-l-4 border-red-500":l===1?"border-l-4 border-yellow-500":""}function q(l){return new Date(l).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})}return(l,e)=>(a(),o("div",z,[e[31]||(e[31]=t("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"Panel de Capturista",-1)),t("div",G,[t("div",H,[e[20]||(e[20]=t("h2",{class:"text-lg font-semibold mb-4"},"Crear Nuevo Turno",-1)),t("form",{onSubmit:S(I,["prevent"]),class:"space-y-4"},[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"},"Paciente",-1)),t("div",X,[u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),type:"text",placeholder:"Buscar por CURP o nombre...",class:"flex-1 px-3 py-2 border border-gray-300 rounded-md",onInput:U},null,544),[[y,v.value]]),t("button",{type:"button",onClick:e[1]||(e[1]=s=>x.value=!0),class:"px-3 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200"}," + Nuevo ")]),b.value.length>0?(a(),o("div",J,[(a(!0),o(w,null,k(b.value,s=>(a(),o("div",{key:s.id,onClick:T=>A(s),class:"p-2 hover:bg-gray-100 cursor-pointer"},[t("span",Q,r(s.full_name),1),s.curp?(a(),o("span",Y,r(s.curp),1)):p("",!0)],8,K))),128))])):p("",!0),c.value?(a(),o("div",Z,[t("span",null,r(c.value.full_name),1),t("button",{type:"button",onClick:e[2]||(e[2]=s=>c.value=null),class:"text-red-500"},"x")])):p("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"Servicio",-1)),u(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.service_id=s),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"},[e[13]||(e[13]=t("option",{value:""},"Seleccione un servicio",-1)),(a(!0),o(w,null,k(E.value,s=>(a(),o("option",{key:s.id,value:s.id},r(s.name),9,ee))),128))],512),[[C,n.value.service_id]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700"},"Doctor (opcional)",-1)),u(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.doctor_id=s),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"},[e[15]||(e[15]=t("option",{value:""},"Asignar despues",-1)),(a(!0),o(w,null,k(N.value,s=>(a(),o("option",{key:s.id,value:s.id},r(s.full_name)+" - "+r(s.office_number),9,te))),128))],512),[[C,n.value.doctor_id]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700"},"Prioridad",-1)),u(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>n.value.priority=s),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"},[...e[17]||(e[17]=[t("option",{value:0},"Normal",-1),t("option",{value:1},"Preferente",-1),t("option",{value:2},"Urgente",-1)])],512),[[C,n.value.priority]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700"},"Notas",-1)),u(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>n.value.notes=s),rows:"2",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"},null,512),[[y,n.value.notes]])]),t("button",{type:"submit",disabled:!n.value.service_id||f.value,class:"w-full py-2 px-4 bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50"},r(f.value?"Creando...":"Crear Turno"),9,se)],32)]),t("div",le,[e[24]||(e[24]=t("h2",{class:"text-lg font-semibold mb-4"},"Turnos del Dia",-1)),t("div",oe,[(a(!0),o(w,null,k(P(m).turns,s=>(a(),o("div",{key:s.id,class:D(["border rounded-lg p-3",W(s.priority)])},[t("div",ae,[t("div",null,[t("span",re,r(s.code),1),t("span",{class:D([h(s.status),"ml-2 px-2 py-1 text-xs rounded"])},r(O(s.status)),3)]),t("div",ne,r(q(s.created_at)),1)]),t("div",ie,[s.patient_name?(a(),o("p",de,[e[21]||(e[21]=t("strong",null,"Paciente:",-1)),_(" "+r(s.patient_name),1)])):p("",!0),t("p",null,[e[22]||(e[22]=t("strong",null,"Servicio:",-1)),_(" "+r(s.service_name),1)]),s.doctor_name?(a(),o("p",ue,[e[23]||(e[23]=t("strong",null,"Doctor:",-1)),_(" "+r(s.doctor_name),1)])):p("",!0)]),s.status==="CREATED"?(a(),o("div",pe,[t("button",{onClick:T=>M(s.id),class:"px-3 py-1 bg-yellow-500 text-white rounded text-sm"}," Poner en Espera ",8,me),t("button",{onClick:T=>$(s.id),class:"px-3 py-1 bg-red-500 text-white rounded text-sm"}," Cancelar ",8,ce)])):p("",!0)],2))),128)),P(m).turns.length===0?(a(),o("p",ve," No hay turnos registrados hoy ")):p("",!0)])])]),x.value?(a(),o("div",be,[t("div",ye,[e[30]||(e[30]=t("h3",{class:"text-lg font-semibold mb-4"},"Registrar Nuevo Paciente",-1)),t("form",{onSubmit:S(R,["prevent"]),class:"space-y-4"},[t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700"},"Nombre Completo *",-1)),u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>i.value.full_name=s),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"},null,512),[[y,i.value.full_name]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700"},"CURP",-1)),u(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>i.value.curp=s),maxlength:"18",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md uppercase"},null,512),[[y,i.value.curp]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700"},"Telefono",-1)),u(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>i.value.phone=s),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"},null,512),[[y,i.value.phone]])]),t("div",xe,[u(t("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=s=>i.value.is_preferential=s),id:"preferential",class:"mr-2"},null,512),[[F,i.value.is_preferential]]),e[28]||(e[28]=t("label",{for:"preferential",class:"text-sm text-gray-700"},"Paciente preferencial",-1))]),t("div",fe,[e[29]||(e[29]=t("button",{type:"submit",class:"flex-1 py-2 px-4 bg-primary-600 text-white rounded-md"},"Guardar",-1)),t("button",{type:"button",onClick:e[11]||(e[11]=s=>x.value=!1),class:"flex-1 py-2 px-4 bg-gray-200 rounded-md"},"Cancelar")])],32)])])):p("",!0)]))}};export{Ce as default};
