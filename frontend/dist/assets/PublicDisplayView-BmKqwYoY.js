import{u as O,m as v}from"./mqttClient-Dn1Xfl5U.js";import{r as _,j as x,k as P,l as R,c as n,a as t,t as o,b as f,F as I,m as N,o as a,n as S}from"./index-B8ei-D0x.js";const A="/sounds/notification.mp3",M=(m,i)=>{const c=m.__vccOpts||m;for(const[u,p]of i)c[u]=p;return c},V={class:"min-h-screen bg-gradient-to-br from-blue-900 to-blue-700 text-white"},j={class:"bg-blue-800 py-4 px-6 flex justify-between items-center"},B={class:"text-right"},F={class:"text-3xl font-mono"},q={class:"text-sm opacity-75"},X={class:"p-6"},z={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},G={class:"lg:col-span-2"},Q={key:0,class:"bg-white text-gray-900 rounded-2xl p-8 shadow-2xl announcement-enter"},Y={class:"text-center"},H={class:"text-8xl font-bold text-primary-600 mb-4"},J={class:"text-3xl font-medium mb-6"},K={class:"flex justify-center items-center space-x-4 text-xl"},W={class:"bg-gray-100 rounded-lg px-6 py-3"},Z={class:"font-bold text-2xl"},$={class:"bg-gray-100 rounded-lg px-6 py-3"},tt={class:"font-bold"},et={key:1,class:"bg-blue-800 rounded-2xl p-8 text-center"},st={class:"mt-6 bg-blue-800 rounded-xl p-4"},ot={class:"grid grid-cols-2 md:grid-cols-3 gap-3"},lt={class:"text-2xl font-bold"},nt={class:"text-sm opacity-75"},at={key:0,class:"col-span-full text-center opacity-50"},it={class:"lg:col-span-1"},ct={class:"bg-blue-800 rounded-xl p-4"},dt={class:"space-y-3"},rt={class:"text-gray-300 text-sm w-8"},ut={class:"flex-1"},pt={class:"text-2xl font-bold"},_t={class:"text-sm opacity-75"},xt={key:0,class:"text-center py-8 opacity-50"},mt={class:"mt-6 bg-blue-800 rounded-xl p-4"},gt={class:"grid grid-cols-2 gap-3 text-center"},yt={class:"bg-blue-700 rounded-lg p-3"},vt={class:"text-3xl font-bold"},ft={class:"bg-blue-700 rounded-lg p-3"},bt={class:"text-3xl font-bold text-green-400"},ht={__name:"PublicDisplayView",setup(m){const i=O(),c=_(null),u=_(""),p=_(""),b=_(null),d=x(()=>i.displayData),r=x(()=>{const s=d.value.called||[];return s.length>0?s[0]:null}),h=x(()=>(d.value.called||[]).slice(1,7)),D=x(()=>d.value.waiting||[]);function E(){const s=new Date;u.value=s.toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),p.value=s.toLocaleDateString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function U(){c.value&&(c.value.currentTime=0,c.value.play().catch(()=>{}))}function L(s){(s.event==="TURN_CALLED"||s.event==="DISPLAY_UPDATE")&&(i.fetchDisplayData(),s.turn&&s.turn.id!==b.value&&(b.value=s.turn.id,U())),s.event==="QUEUE_UPDATE"&&i.fetchDisplayData()}let g=null,y=null;return P(async()=>{E(),g=setInterval(E,1e3),await i.fetchDisplayData(),v.connect(),v.onMessage("display",L),y=setInterval(()=>{i.fetchDisplayData()},3e4)}),R(()=>{g&&clearInterval(g),y&&clearInterval(y),v.offMessage("display")}),(s,e)=>{var T,k,w;return a(),n("div",V,[t("header",j,[e[0]||(e[0]=t("h1",{class:"text-2xl font-bold"},"Sistema de Turnos",-1)),t("div",B,[t("p",F,o(u.value),1),t("p",q,o(p.value),1)])]),t("main",X,[t("div",z,[t("div",G,[r.value?(a(),n("div",Q,[t("div",Y,[e[3]||(e[3]=t("p",{class:"text-gray-500 text-lg mb-2"},"TURNO",-1)),t("p",H,o(r.value.code),1),t("p",J,o(r.value.patient_name||"Paciente"),1),t("div",K,[t("div",W,[e[1]||(e[1]=t("p",{class:"text-gray-500 text-sm"},"CONSULTORIO",-1)),t("p",Z,o(r.value.office_number||"-"),1)]),t("div",$,[e[2]||(e[2]=t("p",{class:"text-gray-500 text-sm"},"DOCTOR",-1)),t("p",tt,o(r.value.doctor_name||"-"),1)])])])])):(a(),n("div",et,[...e[4]||(e[4]=[t("p",{class:"text-4xl opacity-75"},"Esperando turno...",-1)])])),t("div",st,[e[5]||(e[5]=t("h3",{class:"text-lg font-semibold mb-3 opacity-75"},"Turnos Llamados",-1)),t("div",ot,[(a(!0),n(I,null,N(h.value,l=>(a(),n("div",{key:l.id,class:"bg-blue-700 rounded-lg p-3 text-center"},[t("p",lt,o(l.code),1),t("p",nt,o(l.office_number||"Consultorio -"),1)]))),128)),h.value.length===0?(a(),n("p",at," Sin turnos llamados ")):f("",!0)])])]),t("div",it,[t("div",ct,[e[6]||(e[6]=t("h3",{class:"text-xl font-semibold mb-4 text-center"}," Proximos en Espera ",-1)),t("div",dt,[(a(!0),n(I,null,N(D.value,(l,C)=>(a(),n("div",{key:l.id,class:S(["bg-blue-700 rounded-lg p-4 flex items-center",{"opacity-60":C>4}])},[t("span",rt,o(C+1),1),t("div",ut,[t("span",pt,o(l.code),1),l.priority>0?(a(),n("span",{key:0,class:S(["ml-2 text-xs px-2 py-1 rounded",l.priority===2?"bg-red-500":"bg-yellow-500"])},o(l.priority===2?"URGENTE":"PREFERENTE"),3)):f("",!0)]),t("span",_t,o(l.service_name),1)],2))),128)),D.value.length===0?(a(),n("p",xt," No hay turnos en espera ")):f("",!0)])]),t("div",mt,[e[9]||(e[9]=t("h3",{class:"text-lg font-semibold mb-3 text-center opacity-75"},"Estadisticas del Dia",-1)),t("div",gt,[t("div",yt,[t("p",vt,o(((T=d.value.stats)==null?void 0:T.total)||0),1),e[7]||(e[7]=t("p",{class:"text-xs opacity-75"},"Total",-1))]),t("div",ft,[t("p",bt,o(((w=(k=d.value.stats)==null?void 0:k.by_status)==null?void 0:w.DONE)||0),1),e[8]||(e[8]=t("p",{class:"text-xs opacity-75"},"Atendidos",-1))])])])])])]),t("audio",{ref_key:"audioElement",ref:c,preload:"auto"},[...e[10]||(e[10]=[t("source",{src:A,type:"audio/mpeg"},null,-1)])],512)])}}},Tt=M(ht,[["__scopeId","data-v-f6f472c2"]]);export{Tt as default};
