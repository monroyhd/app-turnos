import{u as D,m as p}from"./mqttClient-Dn1Xfl5U.js";import{j as g,k as E,l as N,c as a,a as t,t as o,b as d,i as c,F as _,m as y,o as i,n as f}from"./index-B8ei-D0x.js";const A={class:"max-w-7xl mx-auto px-4 py-6"},S={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},I={class:"lg:col-span-1"},M={class:"bg-white rounded-lg shadow p-6"},O={key:0,class:"space-y-4"},V={class:"text-center p-4 bg-green-50 rounded-lg"},$={class:"text-4xl font-bold text-green-600"},F={class:"text-lg mt-2"},W={class:"text-sm text-gray-600"},j={key:0},z={key:1,class:"text-center py-8 text-gray-500"},B={class:"lg:col-span-2"},H={class:"bg-white rounded-lg shadow p-6"},P={class:"space-y-3"},G={class:"flex items-center space-x-4"},q={class:"text-sm text-gray-400 w-6"},Q={class:"text-xl font-bold text-primary-600"},R={key:0,class:"ml-2 text-sm text-blue-600"},U={class:"text-sm text-gray-600"},X={class:"text-xs text-gray-500"},J={class:"flex space-x-2"},K=["onClick","disabled"],Y=["onClick"],Z=["onClick"],tt=["onClick"],et={key:0,class:"text-gray-500 text-center py-4"},st={class:"bg-white rounded-lg shadow p-6 mt-6"},nt={class:"space-y-2 max-h-48 overflow-y-auto"},ot={class:"font-medium"},at={class:"text-gray-500 ml-2"},it={class:"text-sm text-gray-500"},ct={__name:"DoctorView",setup(lt){const l=D(),r=g(()=>l.turns.find(e=>e.status==="IN_SERVICE")),m=g(()=>l.turns.filter(e=>e.status==="WAITING"||e.status==="CALLED").sort((e,s)=>e.status==="CALLED"&&s.status!=="CALLED"?-1:s.status==="CALLED"&&e.status!=="CALLED"?1:e.priority!==s.priority?s.priority-e.priority:new Date(e.waiting_at)-new Date(s.waiting_at))),v=g(()=>l.turns.filter(e=>["DONE","NO_SHOW","CANCELLED"].includes(e.status)).sort((e,s)=>new Date(s.finished_at)-new Date(e.finished_at)));E(async()=>{await l.fetchMyTurns(),p.connect(),p.onMessage("doctor",async e=>{e.event&&await l.fetchMyTurns()})}),N(()=>{p.offMessage("doctor")});async function h(e){const s=await l.updateTurnStatus(e,"call");s.success||alert(s.message)}async function b(e){await l.updateTurnStatus(e,"start")}async function w(e){await l.updateTurnStatus(e,"finish")}async function C(e){await l.updateTurnStatus(e,"no-show")}async function k(e){await l.updateTurnStatus(e,"recall")}function L(e){return e===2?"border-l-4 border-red-500":e===1?"border-l-4 border-yellow-500":""}function x(e){return e?new Date(e).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"}):"-"}return(e,s)=>(i(),a("div",A,[s[9]||(s[9]=t("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"Panel del Medico",-1)),t("div",S,[t("div",I,[t("div",M,[s[6]||(s[6]=t("h2",{class:"text-lg font-semibold mb-4"},"Turno Actual",-1)),r.value?(i(),a("div",O,[t("div",V,[t("span",$,o(r.value.code),1),t("p",F,o(r.value.patient_name||"Paciente sin registrar"),1),s[1]||(s[1]=t("span",{class:"inline-block mt-2 px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm"}," En Atencion ",-1))]),t("div",W,[t("p",null,[s[2]||(s[2]=t("strong",null,"Servicio:",-1)),c(" "+o(r.value.service_name),1)]),t("p",null,[s[3]||(s[3]=t("strong",null,"Inicio:",-1)),c(" "+o(x(r.value.service_started_at)),1)]),r.value.notes?(i(),a("p",j,[s[4]||(s[4]=t("strong",null,"Notas:",-1)),c(" "+o(r.value.notes),1)])):d("",!0)]),t("button",{onClick:s[0]||(s[0]=n=>w(r.value.id)),class:"w-full py-3 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium"}," Finalizar Atencion ")])):(i(),a("div",z,[...s[5]||(s[5]=[t("p",null,"No hay turno en atencion",-1),t("p",{class:"text-sm mt-2"},"Llame al siguiente paciente",-1)])]))])]),t("div",B,[t("div",H,[s[7]||(s[7]=t("h2",{class:"text-lg font-semibold mb-4"},"Cola de Espera",-1)),t("div",P,[(i(!0),a(_,null,y(m.value,(n,T)=>(i(),a("div",{key:n.id,class:f(["border rounded-lg p-4 flex items-center justify-between",[L(n.priority),n.status==="CALLED"?"bg-blue-50 border-blue-300":""]])},[t("div",G,[t("span",q,o(T+1),1),t("div",null,[t("span",Q,o(n.code),1),n.status==="CALLED"?(i(),a("span",R,"(Llamado)")):d("",!0),t("p",U,o(n.patient_name||"Sin registro"),1),t("p",X,o(n.service_name),1)])]),t("div",J,[n.status==="WAITING"?(i(),a("button",{key:0,onClick:u=>h(n.id),disabled:!!r.value,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"}," Llamar ",8,K)):d("",!0),n.status==="CALLED"?(i(),a(_,{key:1},[t("button",{onClick:u=>b(n.id),class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"}," Iniciar ",8,Y),t("button",{onClick:u=>C(n.id),class:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"}," No se presento ",8,Z),t("button",{onClick:u=>k(n.id),class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"}," Volver a cola ",8,tt)],64)):d("",!0)])],2))),128)),m.value.length===0?(i(),a("p",et," No hay pacientes en espera ")):d("",!0)])]),t("div",st,[s[8]||(s[8]=t("h2",{class:"text-lg font-semibold mb-4"},"Turnos Finalizados Hoy",-1)),t("div",nt,[(i(!0),a(_,null,y(v.value,n=>(i(),a("div",{key:n.id,class:"flex justify-between items-center p-2 bg-gray-50 rounded"},[t("div",null,[t("span",ot,o(n.code),1),t("span",at,o(n.patient_name),1)]),t("div",it,[c(o(x(n.finished_at))+" ",1),t("span",{class:f([n.status==="DONE"?"text-green-600":"text-red-600","ml-2"])},o(n.status==="DONE"?"Atendido":n.status==="NO_SHOW"?"No se presento":"Cancelado"),3)])]))),128))])])])])]))}};export{ct as default};
